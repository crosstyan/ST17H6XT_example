# CMake minimum version
cmake_minimum_required (VERSION 3.1)

# Project Infomation
project( Target 1 )
enable_language(ASM)
enable_language(C)

# Reset output path
set (EXECUTABLE_OUTPUT_PATH ${CMAKE_BINARY_DIR}/bin)
set (LIBRARY_OUTPUT_PATH ${CMAKE_BINARY_DIR}/lib)

# STDLIB
set (CMAKE_SHARED_LIBRARY_LINK_C_FLAGS)

# Set include path
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/inc)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/ble/controller/include)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/osal/include)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/common)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/ble/include)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/ble/hci)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/ble/host)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/Profiles/DevInfo)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/Profiles/SimpleProfile)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/Profiles/Roles)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/driver/common)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/driver/clock)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/driver/gpio)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/driver/pwrmgr)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/driver/log)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/driver/uart)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/driver/flash)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/driver/pwm)
include_directories (./source)
include_directories (./source/bleMesh)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/external/crypto/aes)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/mesh/export/include)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/mesh/export/bearer)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/mesh/export/platforms/ext)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/osal/src/phyos)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/utils/include)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/mesh/export/appl)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/driver/pwrmgr)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/osal/snv)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/external/crypto/asm_ecdh_p256)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/external/crypto/sha256)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/lib)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/profiles/aliGenie)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/mesh/export/cbtimer)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/profiles/ota_app)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/arch/cm0)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../misc)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/driver/timer)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/ble/controller)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/libraries/crc16)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/libraries/cli)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/mesh/export/climodel)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/libraries/fs)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/mesh/export/vendormodel)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/mesh/export/vendormodel/server)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/platforms)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/platforms/interfaces/crypto)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/platforms/mesh)
include_directories (/Users/crosstyan/Code/MCU/bleMesh//../../components/driver/led_light)

# The need build source path and build all files
set (SRC_FILE0 ./source/main.c)
set (SRC_FILE1 /Users/crosstyan/Code/MCU/bleMesh//../../components/driver/pwm/pwm.c)
set (SRC_FILE2 /Users/crosstyan/Code/MCU/bleMesh//../../components/driver/flash/flash.c)
set (SRC_FILE3 /Users/crosstyan/Code/MCU/bleMesh//../../components/driver/clock/clock.c)
set (SRC_FILE4 /Users/crosstyan/Code/MCU/bleMesh//../../components/driver/log/my_printf.c)
set (SRC_FILE5 /Users/crosstyan/Code/MCU/bleMesh//../../components/driver/gpio/gpio.c)
set (SRC_FILE6 /Users/crosstyan/Code/MCU/bleMesh//../../components/driver/uart/uart.c)
set (SRC_FILE7 /Users/crosstyan/Code/MCU/bleMesh//../../components/driver/pwrmgr/pwrmgr.c)
set (SRC_FILE8 /Users/crosstyan/Code/MCU/bleMesh//../../components/libraries/crc16/crc16.c)
set (SRC_FILE9 /Users/crosstyan/Code/MCU/bleMesh//../../components/profiles/DevInfo/devinfoservice.c)
set (SRC_FILE10 /Users/crosstyan/Code/MCU/bleMesh//../../components/profiles/GATT/gattservapp.c)
set (SRC_FILE11 /Users/crosstyan/Code/MCU/bleMesh//../../components/profiles/Roles/gapgattserver.c)
set (SRC_FILE12 /Users/crosstyan/Code/MCU/bleMesh//../../components/profiles/Roles/gap.c)
set (SRC_FILE13 /Users/crosstyan/Code/MCU/bleMesh//../../components/profiles/Roles/observer.c)
set (SRC_FILE14 /Users/crosstyan/Code/MCU/bleMesh//../../components/profiles/Roles/central.c)
set (SRC_FILE15 /Users/crosstyan/Code/MCU/bleMesh//../../components/profiles/Roles/gapbondmgr.c)
set (SRC_FILE16 /Users/crosstyan/Code/MCU/bleMesh//../../misc/jump_table.c)
set (SRC_FILE17 /Users/crosstyan/Code/MCU/bleMesh//../../components/osal/snv/osal_snv.c)
set (SRC_FILE18 ./source/bleMesh/bleMesh.c)
set (SRC_FILE19 ./source/bleMesh/bleMesh_Main.c)
set (SRC_FILE20 ./source/bleMesh/OSAL_bleMesh.c)
set (SRC_FILE21 /Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/external/crypto/sha256/sha256.c)
set (SRC_FILE22 /Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/mesh/export/climodel/cli_model.c)
set (SRC_FILE23 /Users/crosstyan/Code/MCU/bleMesh//../../components/driver/led_light/led_light.c)
set (SRC_FILE24 /Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/platforms/EM_platform.c)
set (SRC_FILE25 /Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/external/crypto/aes/aes.c)
set (SRC_FILE26 /Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/external/crypto/aes/aes-ccm.c)
set (SRC_FILE27 /Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/osal/src/phyos/EM_debug.c)
set (SRC_FILE28 /Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/osal/src/phyos/EM_os.c)
set (SRC_FILE29 /Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/osal/src/phyos/EM_timer.c)
set (SRC_FILE30 /Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/platforms/mesh/blebrr_pl.c)
set (SRC_FILE31 /Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/platforms/interfaces/crypto/cry.c)
set (SRC_FILE32 /Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/mesh/export/bearer/blebrr.c)
set (SRC_FILE33 /Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/mesh/export/bearer/blebrr_gatt.c)
set (SRC_FILE34 /Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/mesh/export/platforms/ext/MS_common_pl.c)
set (SRC_FILE35 /Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/mesh/export/platforms/ext/prov_pl.c)
set (SRC_FILE36 /Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/platforms/mesh/mesh_services.c)
set (SRC_FILE37 /Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/platforms/mesh/model_state_handler_pl.c)
set (SRC_FILE38 /Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/mesh/export/appl/appl_prov.c)
set (SRC_FILE39 /Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/mesh/export/common/MS_limit_config.c)
set (SRC_FILE40 /Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/mesh/export/access_ps/access_ps.c)
set (SRC_FILE41 ./source/bleMesh/appl_sample_example_phylight.c)
set (SRC_FILE42 /Users/crosstyan/Code/MCU/bleMesh//../../components/ethermind/mesh/export/vendormodel/server/vendormodel_server.c)
set (SRC_FILE43 /Users/crosstyan/Code/MCU/bleMesh//../../components/libraries/cli/cliface.c)
set (SRC_FILE44 /Users/crosstyan/Code/MCU/bleMesh//../../components/libraries/cli/cliface.h)


set(CROSS_TARGET_TRIPLET "arm-none-eabi-")

# CC AR LD AS
set(CMAKE_C_COMPILER "${CROSS_TARGET_TRIPLET}gcc")
set(CMAKE_ASM_COMPILER "${CROSS_TARGET_TRIPLET}gcc")

# CFLAGS
set (CMAKE_C_FLAGS "-g -Wextra -Wshadow -Wimplicit-function-declaration -Wredundant-decls -Wmissing-prototypes -Wstrict-prototypes -fno-common -ffunction-sections -fdata-sections -MD -Wall -Wundef -mthumb  " CACHE INTERNAL "c compiler flags")
set (CMAKE_C_FLAGS "${CMAKE_C_FLAGS}  -D CFG_CP  -D  OSAL_CBTIMER_NUM_TASKS=1  -D MTU_SIZE=247 OSALMEM_METRICS=0 DEBUG_INFO=1 CFG_SLEEP_MODE = PWR_MODE_NO_SLEEP CFG_HEARTBEAT_MODE=0 CFG_MESH_FAST_PRO=0 PHY_MCU_TYPE=MCU_BUMBEE_M0 USE_FS=0 MAX_NUM_LL_CONN=1 GATT_MAX_NUM_CONN = MAX_NUM_LL_CONN+1 ")

# CXXFLAGS
set (CMAKE_CXX_FLAGS "-Wextra -Wshadow -Wredundant-decls  -Weffc++ -fno-common -ffunction-sections -fdata-sections -MD -Wall -Wundef -mthumb  " CACHE INTERNAL "cxx compiler flags")

# ASMFLAGS
set (CMAKE_ASM_FLAGS "-g -mthumb  " CACHE INTERNAL "asm compiler flags")

# LDFLAGS
set (CMAKE_EXE_LINKER_FLAGS "-g -Wl,--gc-sections -Wl,-Map=Target 1.map -mthumb  " CACHE INTERNAL "executable linker flags")
set (CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} -T ${CMAKE_SOURCE_DIR}/STM32FLASH.ld -L ")


# Generate the target
add_executable (${CMAKE_PROJECT_NAME}.elf  ${SRC_FILE0}  ${SRC_FILE1}  ${SRC_FILE2}  ${SRC_FILE3}  ${SRC_FILE4}  ${SRC_FILE5}  ${SRC_FILE6}  ${SRC_FILE7}  ${SRC_FILE8}  ${SRC_FILE9}  ${SRC_FILE10}  ${SRC_FILE11}  ${SRC_FILE12}  ${SRC_FILE13}  ${SRC_FILE14}  ${SRC_FILE15}  ${SRC_FILE16}  ${SRC_FILE17}  ${SRC_FILE18}  ${SRC_FILE19}  ${SRC_FILE20}  ${SRC_FILE21}  ${SRC_FILE22}  ${SRC_FILE23}  ${SRC_FILE24}  ${SRC_FILE25}  ${SRC_FILE26}  ${SRC_FILE27}  ${SRC_FILE28}  ${SRC_FILE29}  ${SRC_FILE30}  ${SRC_FILE31}  ${SRC_FILE32}  ${SRC_FILE33}  ${SRC_FILE34}  ${SRC_FILE35}  ${SRC_FILE36}  ${SRC_FILE37}  ${SRC_FILE38}  ${SRC_FILE39}  ${SRC_FILE40}  ${SRC_FILE41}  ${SRC_FILE42}  ${SRC_FILE43}  ${SRC_FILE44} )

# Link the library to the target
target_link_libraries (${CMAKE_PROJECT_NAME}.elf )

# Generate the binary file
add_custom_target (${CMAKE_PROJECT_NAME}.bin ALL arm-none-eabi-objcopy -Obinary "${EXECUTABLE_OUTPUT_PATH}/${CMAKE_PROJECT_NAME}.elf" "${EXECUTABLE_OUTPUT_PATH}/${CMAKE_PROJECT_NAME}.bin" DEPENDS ${EXECUTABLE_OUTPUT_PATH}/${CMAKE_PROJECT_NAME}.elf)

# Generate the hex file
add_custom_target (${CMAKE_PROJECT_NAME}.hex ALL arm-none-eabi-objcopy -Oihex "${EXECUTABLE_OUTPUT_PATH}/${CMAKE_PROJECT_NAME}.elf" "${EXECUTABLE_OUTPUT_PATH}/${CMAKE_PROJECT_NAME}.hex" DEPENDS ${EXECUTABLE_OUTPUT_PATH}/${CMAKE_PROJECT_NAME}.elf)

# Echo the size Infomation
add_custom_target (size ALL arm-none-eabi-size "${EXECUTABLE_OUTPUT_PATH}/${CMAKE_PROJECT_NAME}.elf" DEPENDS ${EXECUTABLE_OUTPUT_PATH}/${CMAKE_PROJECT_NAME}.elf)

# Make flash to the board by st-link
add_custom_target (flash COMMAND st-flash write ${EXECUTABLE_OUTPUT_PATH}/${CMAKE_PROJECT_NAME}.bin 0x8000000)

# Make clean-all
add_custom_target (clean-all COMMAND rm -rf ${CMAKE_BINARY_DIR}/*)